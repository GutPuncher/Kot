tools:
  - name: host-llvm-backend
    source:
      subdir: 'Toolchain'
      git: 'https://github.com/kot-org/llvm-project'
      branch: 'release/14.x'
      version: '14.x'
    configure:
      - args:
        - 'cmake'
        - '-DCMAKE_C_COMPILER=clang-14'
        - '-DCMAKE_CXX_COMPILER=clang++-14'
        - '-DCMAKE_INSTALL_PREFIX=@SOURCE_ROOT@/Toolchain/local' 
        - '-DLLVM_ENABLE_PROJECTS=clang;lld'
        - '-DCMAKE_BUILD_TYPE=Release'
        - '-DBUILD_SHARED_LIBS=ON' 
        - '-DLLVM_PARALLEL_LINK_JOBS=2'
        - '-DLLVM_USE_LINKER=lld'
        - '-G Ninja'
        - '@SOURCE_ROOT@/Toolchain/host-llvm-backend/llvm'
    compile:
      - args: ['ninja', 'all']
    install:
      - args: ['ninja', 'install']

  - name: host-llvm
    source:
      subdir: 'Tools'
    tools_required:
      - host-llvm-backend
    compile:
      - args: ['sh', '@SOURCE_ROOT@/Tools/BuildCompilers.sh']

  - name: host-automake
    from_source: automake
    configure:
      - args: ['@THIS_SOURCE_DIR@/configure', '--prefix=@PREFIX@']
        environ:
          MAKEINFO: '/bin/true'
    compile:
      - args: ['make', '-j@PARALLELISM@']
    install:
      - args: ['make', 'install']
      - args: ['ln', '-sf', '@PREFIX@/share/aclocal-1.16', '@PREFIX@/share/aclocal']

  - name: host-autoconf-v2.69 # Some things e.g. binutils want exactly this version, painnnnnn
    source:
      name: host-autoconf-v2.69
      subdir: 'Toolchain'
      url: 'https://ftp.gnu.org/gnu/autoconf/autoconf-2.69.tar.gz'
      format: 'tar.gz' # Only ~600K larger than .xz
      extract_path: 'autoconf-2.69'
      version: '2.69'
    configure:
      - args: ['@THIS_SOURCE_DIR@/configure', '--prefix=@PREFIX@']
    compile:
      - args: ['make', '-j@PARALLELISM@']
    install:
      - args: ['make', 'install']


sources:
  - name: automake
    subdir: 'Toolchain'
    git: 'https://git.savannah.gnu.org/git/automake.git'
    tag: 'v1.16.5'
    version: '1.16.5'
    tools_required:
      - host-autoconf-v2.69
    regenerate:
      - args: ['./bootstrap']